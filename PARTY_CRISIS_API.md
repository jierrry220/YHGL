# æ´¾å¯¹å±æœºæ¸¸æˆ API æ–‡æ¡£

Party Crisis Game API - Multiplayer betting game with killer mechanics

## ğŸ® æ¸¸æˆæ¦‚è¿°

æ´¾å¯¹å±æœºæ˜¯ä¸€æ¬¾å¤šäººåœ¨çº¿æŠ•æ³¨æ¸¸æˆï¼Œç©å®¶åœ¨8ä¸ªæˆ¿é—´ä¸­é€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•æ³¨ï¼Œå€’è®¡æ—¶ç»“æŸåæ€æ‰‹ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæˆ¿é—´è¿›è¡Œåˆºæ€ï¼Œå¹¸å­˜ç©å®¶æ ¹æ®æŠ•æ³¨æƒé‡ç“œåˆ†è¢«åˆºæ€ç©å®¶çš„æ€»æŠ•æ³¨é¢çš„90%ï¼ˆæ‰£é™¤10%å¹³å°è´¹ï¼‰ã€‚

### æ¸¸æˆæµç¨‹

1. **æŠ•æ³¨é˜¶æ®µ** (60ç§’)
   - ç©å®¶é€‰æ‹©1-8å·æˆ¿é—´ä¸‹æ³¨
   - æŠ•æ³¨èŒƒå›´: 1-500 DP
   - å¯è¿½åŠ æŠ•æ³¨ï¼Œä½†ä¸èƒ½æ›´æ¢æˆ¿é—´
   - Botç©å®¶è‡ªåŠ¨ç”Ÿæˆ (15-25ä¸ª)

2. **æ€æ‰‹é˜¶æ®µ** (14ç§’)
   - æ€æ‰‹å‡ºç°å¹¶å‰å¾€éšæœºé€‰æ‹©çš„æˆ¿é—´ (9ç§’)
   - åˆºæ€æˆ¿é—´å†…çš„æ‰€æœ‰ç©å®¶ (1ç§’)
   - æ€æ‰‹æ’¤é€€è¿”å›å…¥å£ (4ç§’)

3. **ç»“ç®—é˜¶æ®µ**
   - è®¡ç®—å¹¸å­˜è€…å¥–åŠ±
   - è‡ªåŠ¨åˆ†é…DPåˆ°è´¦æˆ·
   - 5ç§’åå¼€å§‹æ–°æ¸¸æˆ

## ğŸ“¡ API ç«¯ç‚¹

### 1. è·å–å½“å‰æ¸¸æˆçŠ¶æ€

**GET** `/api/party-crisis/status`

è·å–å½“å‰æ­£åœ¨è¿›è¡Œçš„æ¸¸æˆçŠ¶æ€

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "game": {
    "gameId": 123,
    "phase": "betting",
    "countdown": 45,
    "players": [
      {
        "address": "0x1234...5678",
        "roomId": 3,
        "amount": 50,
        "username": "Bear2847",
        "joinedAt": 1700000000000
      }
    ],
    "bots": [
      {
        "id": "bot-123-0",
        "name": "Wolf1923",
        "roomId": 5,
        "amount": 30,
        "isBot": true
      }
    ],
    "targetRoom": null,
    "roomStats": {
      "1": { "playerCount": 3, "totalBet": 120 },
      "2": { "playerCount": 5, "totalBet": 200 },
      ...
    },
    "startTime": 1700000000000,
    "endTime": null,
    "history": []
  },
  "config": {
    "roundDuration": 60,
    "minBet": 1,
    "maxBet": 500,
    "platformFee": 0.1
  }
}
```

### 2. ä¸‹æ³¨

**POST** `/api/party-crisis/bet`

ç©å®¶ä¸‹æ³¨åˆ°æŒ‡å®šæˆ¿é—´

**è¯·æ±‚ä½“:**
```json
{
  "address": "0x1234567890abcdef1234567890abcdef12345678",
  "roomId": 3,
  "amount": 50
}
```

**å‚æ•°è¯´æ˜:**
- `address` (string, å¿…éœ€): ç©å®¶é’±åŒ…åœ°å€
- `roomId` (number, å¿…éœ€): æˆ¿é—´ID (1-8)
- `amount` (number, å¿…éœ€): æŠ•æ³¨é‡‘é¢ (1-500 DP)

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "message": "ä¸‹æ³¨æˆåŠŸ",
  "game": {
    "gameId": 123,
    "phase": "betting",
    "countdown": 42,
    ...
  },
  "balance": 950
}
```

**é”™è¯¯å“åº”:**
```json
{
  "success": false,
  "error": "ä½™é¢ä¸è¶³"
}
```

**å¯èƒ½çš„é”™è¯¯:**
- `æ— æ•ˆçš„é’±åŒ…åœ°å€`
- `æ— æ•ˆçš„æˆ¿é—´ID`
- `æŠ•æ³¨é‡‘é¢å¿…é¡»åœ¨ 1-500 DP ä¹‹é—´`
- `ä½™é¢ä¸è¶³`
- `å½“å‰ä¸åœ¨æŠ•æ³¨é˜¶æ®µ`
- `å·²ä¸‹æ³¨ï¼Œæ— æ³•æ›´æ¢æˆ¿é—´`

### 3. è·å–ç©å®¶å½“å‰æ¸¸æˆ

**GET** `/api/party-crisis/my-game/:address`

è·å–ç©å®¶å½“å‰å‚ä¸çš„æ¸¸æˆçŠ¶æ€

**è·¯å¾„å‚æ•°:**
- `address`: ç©å®¶é’±åŒ…åœ°å€

**å“åº”ç¤ºä¾‹ (åœ¨æ¸¸æˆä¸­):**
```json
{
  "success": true,
  "inGame": true,
  "game": {
    "gameId": 123,
    "phase": "betting",
    ...
  },
  "myBet": {
    "address": "0x1234...5678",
    "roomId": 3,
    "amount": 50,
    "username": "Bear2847",
    "joinedAt": 1700000000000
  }
}
```

**å“åº”ç¤ºä¾‹ (ä¸åœ¨æ¸¸æˆä¸­):**
```json
{
  "success": true,
  "inGame": false,
  "message": "æœªå‚ä¸æ¸¸æˆ"
}
```

### 4. è·å–æ¸¸æˆå†å²

**GET** `/api/party-crisis/history`

è·å–æœ€è¿‘çš„æ¸¸æˆå†å²è®°å½•

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "history": [
    {
      "killedRoom": 5,
      "timestamp": 1700000000000,
      "killedCount": 8,
      "survivorCount": 15,
      "prizePool": 450
    },
    {
      "killedRoom": 2,
      "timestamp": 1699999900000,
      "killedCount": 6,
      "survivorCount": 17,
      "prizePool": 380
    }
  ]
}
```

## ğŸ“Š æ¸¸æˆé…ç½®

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| æŠ•æ³¨é˜¶æ®µæ—¶é•¿ | 60ç§’ | ç©å®¶å¯ä¸‹æ³¨çš„æ—¶é—´ |
| æœ€å°æŠ•æ³¨ | 1 DP | æœ€ä½æŠ•æ³¨é‡‘é¢ |
| æœ€å¤§æŠ•æ³¨ | 500 DP | æœ€é«˜æŠ•æ³¨é‡‘é¢ |
| å¹³å°è´¹ç‡ | 10% | ä»è¢«æ€ç©å®¶æŠ•æ³¨ä¸­æŠ½å– |
| Botæ•°é‡ | 15-25ä¸ª | æ¯å±€éšæœºç”Ÿæˆ |
| æ€æ‰‹é˜¶æ®µ | 14ç§’ | å‰å¾€(9s)+åˆºæ€(1s)+æ’¤é€€(4s) |

## ğŸ  æˆ¿é—´é…ç½®

| ID | åç§° | è¯´æ˜ |
|----|------|------|
| 1 | åŠå…¬åŒº | Office |
| 2 | é…’å§ | Bar |
| 3 | ä¼‘æ¯åŒº | Lounge |
| 4 | VIPåŒ…å¢ | VIP Room |
| 5 | é¤é¥®åŒº | Dining |
| 6 | åŒ…å¢åŒº | Private Room |
| 7 | é¤å… | Restaurant |
| 8 | èˆæ±  | Dance Floor |

## ğŸ¯ æ¸¸æˆæœºåˆ¶

### å¥–åŠ±è®¡ç®—

1. **è¢«æ€ç©å®¶æ€»æŠ•æ³¨**: å‡è®¾ä¸º `K` DP
2. **å¹³å°è´¹**: `K Ã— 10% = 0.1K` DP
3. **å¥–æ± **: `K Ã— 90% = 0.9K` DP
4. **å¹¸å­˜è€…å¥–åŠ±**: æ ¹æ®æŠ•æ³¨æƒé‡åˆ†é…

**ç¤ºä¾‹:**
- ç©å®¶A: æŠ•æ³¨ 100 DP åˆ°æˆ¿é—´3
- ç©å®¶B: æŠ•æ³¨ 50 DP åˆ°æˆ¿é—´3
- æˆ¿é—´3è¢«æ€ï¼Œæ€»æŸå¤±: 150 DP
- å¥–æ± : 150 Ã— 0.9 = 135 DP
- å…¶ä»–å¹¸å­˜ç©å®¶æ ¹æ®æŠ•æ³¨æƒé‡åˆ†é…è¿™135 DP

**æƒé‡è®¡ç®—:**
```
ç©å®¶æƒé‡ = ç©å®¶æŠ•æ³¨ / å¹¸å­˜ç©å®¶æ€»æŠ•æ³¨
ç©å®¶å¥–åŠ± = å¥–æ±  Ã— ç©å®¶æƒé‡
```

### æ¸¸æˆçŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| `betting` | æŠ•æ³¨é˜¶æ®µï¼Œç©å®¶å¯ä¸‹æ³¨ |
| `killer_moving` | æ€æ‰‹é˜¶æ®µï¼Œæ€æ‰‹ç§»åŠ¨å¹¶åˆºæ€ |
| `settling` | ç»“ç®—é˜¶æ®µï¼Œåˆ†é…å¥–åŠ± |

## ğŸ”„ å®Œæ•´æ¸¸æˆå‘¨æœŸ

```
æ–°æ¸¸æˆåˆ›å»º
    â†“
ç”Ÿæˆ15-25ä¸ªBotç©å®¶
    â†“
æŠ•æ³¨é˜¶æ®µ (60ç§’å€’è®¡æ—¶)
    â”œâ”€ ç©å®¶å¯éšæ—¶åŠ å…¥ä¸‹æ³¨
    â”œâ”€ å¯è¿½åŠ æŠ•æ³¨
    â””â”€ ä¸å¯æ›´æ¢æˆ¿é—´
    â†“
å€’è®¡æ—¶å½’é›¶
    â†“
éšæœºé€‰æ‹©ç›®æ ‡æˆ¿é—´
    â†“
æ€æ‰‹é˜¶æ®µ (14ç§’)
    â”œâ”€ æ€æ‰‹å‰å¾€ç›®æ ‡æˆ¿é—´ (9ç§’)
    â”œâ”€ åˆºæ€ç©å®¶ (1ç§’)
    â””â”€ æ€æ‰‹æ’¤é€€ (4ç§’)
    â†“
ç»“ç®—é˜¶æ®µ
    â”œâ”€ æ‰£é™¤å¹³å°è´¹ (10%)
    â”œâ”€ è®¡ç®—å¹¸å­˜è€…æƒé‡
    â””â”€ åˆ†é…å¥–åŠ±åˆ°è´¦æˆ·
    â†“
5ç§’åæ¸…ç†æ¸¸æˆæ•°æ®
    â†“
è‡ªåŠ¨å¼€å§‹æ–°æ¸¸æˆ
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### JavaScript å‰ç«¯é›†æˆ

```javascript
const API_BASE = 'http://localhost:3000/api/party-crisis';

// 1. è·å–æ¸¸æˆçŠ¶æ€
async function getGameStatus() {
  const response = await fetch(`${API_BASE}/status`);
  const data = await response.json();
  return data;
}

// 2. ä¸‹æ³¨
async function placeBet(address, roomId, amount) {
  const response = await fetch(`${API_BASE}/bet`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      address: address,
      roomId: roomId,
      amount: amount
    })
  });
  const data = await response.json();
  return data;
}

// 3. è½®è¯¢æ¸¸æˆçŠ¶æ€ (æ¯ç§’æ›´æ–°)
function startGameLoop() {
  setInterval(async () => {
    const status = await getGameStatus();
    updateUI(status.game);
  }, 1000);
}

// 4. è·å–ç©å®¶æ¸¸æˆ
async function getMyGame(address) {
  const response = await fetch(`${API_BASE}/my-game/${address}`);
  const data = await response.json();
  return data;
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä½™é¢æ£€æŸ¥**: ä¸‹æ³¨å‰ä¼šè‡ªåŠ¨æ£€æŸ¥ç©å®¶ä½™é¢ï¼Œä½™é¢ä¸è¶³ä¼šè¿”å›é”™è¯¯
2. **æ¸¸æˆé˜¶æ®µé™åˆ¶**: åªèƒ½åœ¨ `betting` é˜¶æ®µä¸‹æ³¨
3. **æˆ¿é—´é”å®š**: é¦–æ¬¡ä¸‹æ³¨åï¼Œæ— æ³•æ›´æ¢æˆ¿é—´ï¼Œåªèƒ½è¿½åŠ æŠ•æ³¨
4. **è‡ªåŠ¨ç»“ç®—**: æ¸¸æˆç»“æŸåä¼šè‡ªåŠ¨å°†å¥–åŠ±æ·»åŠ åˆ°ç©å®¶ä½™é¢
5. **æ¸¸æˆæ¸…ç†**: ç»“ç®—5ç§’åä¼šæ¸…ç†æ¸¸æˆæ•°æ®ï¼Œè‡ªåŠ¨å¼€å§‹æ–°æ¸¸æˆ
6. **å®æ—¶æ›´æ–°**: å»ºè®®å‰ç«¯æ¯ç§’è½®è¯¢ä¸€æ¬¡æ¸¸æˆçŠ¶æ€ä»¥è·å–å®æ—¶æ›´æ–°

## ğŸ”§ æµ‹è¯• API

```bash
# è·å–æ¸¸æˆçŠ¶æ€
curl http://localhost:3000/api/party-crisis/status

# ä¸‹æ³¨
curl -X POST http://localhost:3000/api/party-crisis/bet \
  -H "Content-Type: application/json" \
  -d '{
    "address": "0x1234567890abcdef1234567890abcdef12345678",
    "roomId": 3,
    "amount": 50
  }'

# è·å–ç©å®¶æ¸¸æˆ
curl http://localhost:3000/api/party-crisis/my-game/0x1234567890abcdef1234567890abcdef12345678

# è·å–å†å²
curl http://localhost:3000/api/party-crisis/history
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-11-26)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®ç°å®Œæ•´æ¸¸æˆæµç¨‹
- âœ… æ”¯æŒå¤šäººåœ¨çº¿æ¸¸æˆ
- âœ… è‡ªåŠ¨Botç©å®¶ç”Ÿæˆ
- âœ… å®æ—¶æ¸¸æˆçŠ¶æ€åŒæ­¥
- âœ… è‡ªåŠ¨å¥–åŠ±åˆ†é…ç³»ç»Ÿ
